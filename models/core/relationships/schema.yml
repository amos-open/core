version: 2

models:
  - name: commitment
    description: "Fund-investor commitment relationships"
    config:
      contract:
        enforced: true
    columns:
      - name: id
        data_type: uuid
        description: "Unique commitment identifier (UUID)"
        constraints:
          - type: not_null
          - type: primary_key
        tests:
          - unique
          - not_null
      - name: fund_id
        data_type: uuid
        description: "Foreign key to fund table"
        constraints:
          - type: not_null
        tests:
          - not_null
          - relationships:
              to: ref('fund')
              field: id
      - name: investor_id
        data_type: uuid
        description: "Foreign key to investor table"
        constraints:
          - type: not_null
        tests:
          - not_null
          - relationships:
              to: ref('investor')
              field: id
      - name: created_at
        data_type: timestamp
        description: "Record creation timestamp"
      - name: updated_at
        data_type: timestamp
        description: "Record last update timestamp"
    
  - name: instrument
    description: "Unified instrument model for all financial positions (equity and loan instruments)"
    config:
      contract:
        enforced: true
    columns:
      - name: id
        data_type: varchar(36)
        description: "Unique instrument identifier (UUID)"
        constraints:
          - type: not_null
          - type: primary_key
        tests:
          - unique
          - not_null
      - name: fund_id
        data_type: varchar(36)
        description: "Foreign key to fund table"
        constraints:
          - type: not_null
        tests:
          - not_null
          - relationships:
              to: ref('fund')
              field: id
      - name: company_id
        data_type: varchar(36)
        description: "Foreign key to company table (required for equity instruments)"
        tests:
          - relationships:
              to: ref('company')
              field: id
      - name: instrument_type
        data_type: varchar(20)
        description: "Type of instrument (EQUITY, LOAN, CONVERTIBLE, WARRANT, FUND_INTEREST)"
        constraints:
          - type: not_null
        tests:
          - not_null
          - accepted_values:
              values: ['EQUITY', 'LOAN', 'CONVERTIBLE', 'WARRANT', 'FUND_INTEREST']
              quote: true
      - name: base_currency_code
        data_type: varchar(3)
        description: "Base currency code for the instrument"
        constraints:
          - type: not_null
        tests:
          - not_null
          - relationships:
              to: ref('currency')
              field: code
      - name: inception_date
        data_type: date
        description: "Date when the instrument was created/acquired"
      - name: termination_date
        data_type: date
        description: "Date when the instrument was terminated/disposed"
      - name: description
        data_type: text
        description: "Instrument description"
      - name: created_at
        data_type: timestamp
        description: "Record creation timestamp"
      - name: updated_at
        data_type: timestamp
        description: "Record last update timestamp"
    

  - name: opportunity
    description: "Investment opportunity pipeline data"
    config:
      contract:
        enforced: true
    columns:
      - name: id
        data_type: uuid
        description: "Unique opportunity identifier (UUID)"
        constraints:
          - type: not_null
          - type: primary_key
        tests:
          - unique
          - not_null
      - name: fund_id
        data_type: uuid
        description: "Foreign key to fund table"
        constraints:
          - type: not_null
        tests:
          - not_null
          - relationships:
              to: ref('fund')
              field: id
      - name: name
        data_type: varchar(255)
        description: "Name of the investment opportunity"
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: stage_id
        data_type: uuid
        description: "Foreign key to stage table"
        tests:
          - relationships:
              to: ref('stage')
              field: id
      - name: company_id
        data_type: uuid
        description: "Foreign key to company table (optional)"
        tests:
          - relationships:
              to: ref('company')
              field: id
      - name: responsible
        data_type: varchar(255)
        description: "Person responsible for the opportunity"
      - name: amount
        data_type: numeric(20,2)
        description: "Potential investment amount"
      - name: next_step
        data_type: varchar(255)
        description: "Description of next step"
      - name: source
        data_type: varchar(128)
        description: "Source of the opportunity"
      - name: close_date
        data_type: date
        description: "Expected or actual close date"
      - name: created_at
        data_type: timestamp
        description: "Record creation timestamp"
      - name: updated_at
        data_type: timestamp
        description: "Record last update timestamp"