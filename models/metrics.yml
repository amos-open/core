version: 2

semantic_models:
  - name: fct_transactions
    description: "Fact table for transactions"
    model: ref('fct_transactions')
    
    defaults:
      agg_time_dimension: transaction_date
    
    entities:
      - name: transaction_id
        type: primary
        expr: transaction_id
      - name: fund_id
        type: foreign
        expr: fund_id
      - name: investor_id
        type: foreign
        expr: investor_id
      - name: company_id
        type: foreign
        expr: company_id
    
    dimensions:
      - name: transaction_date
        type: time
        expr: transaction_date
        type_params:
          time_granularity: day
      - name: transaction_type
        type: categorical
        expr: transaction_type
      - name: amount
        type: continuous
        expr: amount
      - name: currency_code
        type: categorical
        expr: currency_code
    
    measures:
      - name: total_transactions
        agg: count
        expr: transaction_id
      - name: total_amount
        agg: sum
        expr: amount
      - name: avg_amount
        agg: average
        expr: amount
      - name: unique_transactions
        agg: count_distinct
        expr: transaction_id

  - name: dim_fund
    description: "Dimension table for funds"
    model: ref('dim_fund')
    
    entities:
      - name: fund_id
        type: primary
        expr: fund_id
    
    dimensions:
      - name: fund_name
        type: categorical
        expr: fund_name
      - name: fund_code
        type: categorical
        expr: fund_code
      - name: base_currency_code
        type: categorical
        expr: base_currency_code
    
    measures:
      - name: unique_funds
        agg: count_distinct
        expr: fund_id

  - name: dim_investor
    description: "Dimension table for investors"
    model: ref('dim_investor')
    
    entities:
      - name: investor_id
        type: primary
        expr: investor_id
    
    dimensions:
      - name: investor_name
        type: categorical
        expr: investor_name
      - name: investor_code
        type: categorical
        expr: investor_code
    
    measures:
      - name: unique_investors
        agg: count_distinct
        expr: investor_id

  - name: dim_company
    description: "Dimension table for companies"
    model: ref('dim_company')
    
    entities:
      - name: company_id
        type: primary
        expr: company_id
    
    dimensions:
      - name: company_name
        type: categorical
        expr: company_name
      - name: country_code
        type: categorical
        expr: country_code
      - name: currency_code
        type: categorical
        expr: currency_code
    
    measures:
      - name: unique_companies
        agg: count_distinct
        expr: company_id
